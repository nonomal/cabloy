{"version":3,"file":"backend.js","mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,iBAAiB,gBAAgB;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA,uBAAuB,QAAQ;AAC/B,WAAW;AACX;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;;;;;;;;ACtCA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,sCAAsC;AACtC;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA,yCAAyC;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACXA,iBAAiB,mBAAO,CAAC,GAAU;AACnC;AACA;AACA;;AAEA,uBAAuB;;AAEvB;AACA;AACA;AACA,mBAAmB,0DAA0D;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC9EA;AACA;AACA;AACA,4BAA4B,8DAA8D;AAC1F;AACA,iDAAiD,6CAA6C;AAC9F;AACA;AACA,2CAA2C,8DAA8D;AACzG;;AAEA,iCAAiC,SAAS;AAC1C;AACA;AACA,yCAAyC,oBAAoB;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;;;;;;;AClCA,uBAAuB,mBAAO,CAAC,GAA2B;AAC1D,sBAAsB,mBAAO,CAAC,GAA2B;AACzD,sBAAsB,mBAAO,CAAC,GAA2B;AACzD,kCAAkC,mBAAO,CAAC,GAAsC;AAChF,+BAA+B,mBAAO,CAAC,GAAmC;AAC1E,iBAAiB,mBAAO,CAAC,GAAqB;AAC9C,2BAA2B,mBAAO,CAAC,GAA+B;;AAElE;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;AC/CA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;;;;;;;AChDA;AACA;;;;;;;;ACDA;AACA;AACA;;;;;;;;ACFA;AACA;AACA;AACA;;;;;;;;ACHA;AACA,WAAW,mBAAO,CAAC,GAAmB;AACtC,WAAW,mBAAO,CAAC,EAAmB;AACtC;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;;;;;;;ACpBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;ACnFA,kBAAkB,mBAAO,CAAC,GAAuB;;AAEjD;AACA;AACA;AACA;AACA;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,yBAAyB,MAAM;AAC/B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,yBAAyB,MAAM;AAC/B;AACA;;AAEA;AACA;;;;;;;;AC5DA,cAAc,mBAAO,CAAC,EAAuB;;AAE7C;AACA,wBAAwB;AACxB;AACA;;;;;;;;ACLA,eAAe,mBAAO,CAAC,EAAoB;AAC3C,gBAAgB,mBAAO,CAAC,EAAqB;AAC7C,eAAe,mBAAO,CAAC,GAAoB;;AAE3C;AACA;AACA,gBAAgB,mBAAO,CAAC,GAAY;AACpC;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,sBAAsB,mBAAO,CAAC,EAAkB;AAChD;AACA,mBAAmB,mBAAO,CAAC,GAAe;AAC1C;AACA,iBAAiB,mBAAO,CAAC,GAAa;AACtC;AACA,eAAe,mBAAO,CAAC,GAAW;;AAElC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC7BA;AACA;AACA,kBAAkB,mBAAO,CAAC,GAAgC;AAC1D;AACA,8BAA8B,mBAAO,CAAC,GAAkC;AACxE,8BAA8B,mBAAO,CAAC,GAAkC;AACxE;AACA,0BAA0B,mBAAO,CAAC,GAA8B;AAChE;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP,kBAAkB;AAClB;AACA,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;;;;;;;;ACrCA;AACA;AACA;AACA,mBAAmB,2BAA2B,yBAAyB;AACvE;AACA;AACA;AACA;;;;;;;;ACPA,aAAa,mBAAO,CAAC,EAAiB;;AAEtC;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,SAAS,4CAA4C;AACnE,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,0CAA0C;AAC3D,oBAAoB,wBAAwB;AAC5C,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA,cAAc,SAAS,4CAA4C;AACnE,KAAK;AACL;AACA;AACA;AACA;AACA,cAAc,SAAS,4CAA4C;AACnE,KAAK;AACL;AACA;AACA;;;;;;;;ACjCA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,iBAAiB,iBAAiB;AAClC;AACA;AACA,yCAAyC;AACzC,yBAAyB,iBAAiB;AAC1C;;AAEA,kBAAkB,iBAAiB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mBAAmB,WAAW;AAC9B,yBAAyB,4BAA4B;AACrD;;AAEA,gBAAgB,iBAAiB;AACjC,yCAAyC;AACzC,yBAAyB,iBAAiB;AAC1C;AACA;;AAEA;AACA;;;;;;;;ACtCA,cAAc,mBAAO,CAAC,EAAoB;;AAE1C;AACA,qBAAqB;AACrB;AACA;;;;;;;;;ACLA;;;;;;UCAA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;UEtBA;UACA;UACA;UACA","sources":["webpack://egg-born-module-a-mail/./backend/src/bean/bean.mail.js","webpack://egg-born-module-a-mail/./backend/src/bean/bean.mailSceneCache.js","webpack://egg-born-module-a-mail/./backend/src/bean/broadcast.mailSceneChanged.js","webpack://egg-born-module-a-mail/./backend/src/bean/io.channel.mail.js","webpack://egg-born-module-a-mail/./backend/src/bean/io.message.mail.js","webpack://egg-born-module-a-mail/./backend/src/bean/startup.cacheMailScenes.js","webpack://egg-born-module-a-mail/./backend/src/bean/version.manager.js","webpack://egg-born-module-a-mail/./backend/src/beans.js","webpack://egg-born-module-a-mail/./backend/src/config/config.js","webpack://egg-born-module-a-mail/./backend/src/config/errors.js","webpack://egg-born-module-a-mail/./backend/src/config/locale/en-us.js","webpack://egg-born-module-a-mail/./backend/src/config/locale/zh-cn.js","webpack://egg-born-module-a-mail/./backend/src/config/locales.js","webpack://egg-born-module-a-mail/./backend/src/config/socketio/channelMail.js","webpack://egg-born-module-a-mail/./backend/src/config/socketio/messageMail.js","webpack://egg-born-module-a-mail/./backend/src/config/static/resources.js","webpack://egg-born-module-a-mail/./backend/src/config/validation/schema/mailScene.js","webpack://egg-born-module-a-mail/./backend/src/config/validation/schemas.js","webpack://egg-born-module-a-mail/./backend/src/controller/scene.js","webpack://egg-born-module-a-mail/./backend/src/controllers.js","webpack://egg-born-module-a-mail/./backend/src/main.js","webpack://egg-born-module-a-mail/./backend/src/meta.js","webpack://egg-born-module-a-mail/./backend/src/model/mail.js","webpack://egg-born-module-a-mail/./backend/src/models.js","webpack://egg-born-module-a-mail/./backend/src/routes.js","webpack://egg-born-module-a-mail/./backend/src/service/scene.js","webpack://egg-born-module-a-mail/./backend/src/services.js","webpack://egg-born-module-a-mail/external commonjs2 \"require3\"","webpack://egg-born-module-a-mail/webpack/bootstrap","webpack://egg-born-module-a-mail/webpack/before-startup","webpack://egg-born-module-a-mail/webpack/startup","webpack://egg-born-module-a-mail/webpack/after-startup"],"sourcesContent":["module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Mail extends ctx.app.meta.BeanModuleBase {\n    constructor(moduleName) {\n      super(ctx, 'mail');\n      this.moduleName = moduleName || ctx.module.info.relativeName;\n    }\n\n    get modelMail() {\n      return ctx.model.module(moduleInfo.relativeName).mail;\n    }\n\n    // send\n    async send({ scene, message }) {\n      // save to db\n      const res = await this.modelMail.insert({\n        scene,\n        status: 0,\n        mailto: message.to,\n        mailSubject: message.subject,\n        message: JSON.stringify(message),\n      });\n      const mailId = res.insertId;\n      // publish\n      ctx.tail(async () => {\n        await ctx.bean.io.publish({\n          message: {\n            content: { mailId },\n          },\n          messageClass: {\n            module: moduleInfo.relativeName,\n            messageClassName: 'mail',\n          },\n        });\n      });\n    }\n  }\n  return Mail;\n};\n","const __mailScenesConfigCache = {};\n\nmodule.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class MailSceneCache {\n    get configModule() {\n      return ctx.config.module(moduleInfo.relativeName);\n    }\n    get statusModule() {\n      return ctx.bean.status.module(moduleInfo.relativeName);\n    }\n\n    getMailScenesConfigCache() {\n      return __mailScenesConfigCache[ctx.subdomain];\n    }\n\n    getMailSceneConfigCache(sceneName) {\n      return __mailScenesConfigCache[ctx.subdomain][sceneName];\n    }\n\n    getMailScenesConfigForAdmin() {\n      let scenes = this.getMailScenesConfigCache();\n      scenes = ctx.bean.util.extend({}, scenes);\n      for (const sceneName in scenes) {\n        const scene = scenes[sceneName];\n        scene.titleLocale = ctx.text(scene.title);\n      }\n      return scenes;\n    }\n\n    async mailSceneChanged() {\n      // change self\n      await this._cacheMailScenesConfig();\n      // broadcast\n      ctx.meta.util.broadcastEmit({\n        module: 'a-mail',\n        broadcastName: 'mailSceneChanged',\n        data: null,\n      });\n    }\n\n    purgeScene(scene) {\n      const res = ctx.bean.util.extend({}, scene);\n      delete res.titleLocale;\n      return res;\n    }\n\n    async _cacheMailScenesConfig() {\n      // configDefault\n      const configDefault = this.configModule.scenes;\n      // configScenes\n      let configScenes = await this.statusModule.get('mailScenes');\n      configScenes = ctx.bean.util.extend({}, configDefault, configScenes);\n      // cache\n      __mailScenesConfigCache[ctx.subdomain] = configScenes;\n    }\n  }\n  return MailSceneCache;\n};\n","module.exports = app => {\n  class Broadcast extends app.meta.BeanBase {\n    async execute(context) {\n      const sameAsCaller = context.sameAsCaller;\n      if (!sameAsCaller) {\n        await this.ctx.bean.mailSceneCache._cacheMailScenesConfig();\n      }\n    }\n  }\n\n  return Broadcast;\n};\n","const require3 = require('require3');\nconst nodemailer = require3('nodemailer');\nconst chalk = require3('chalk');\nconst boxen = require3('boxen');\n\nconst boxenOptions = { padding: 1, margin: 1, align: 'center', borderColor: 'yellow', borderStyle: 'round' };\n\nmodule.exports = ctx => {\n  // const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class IOChannel extends ctx.app.meta.IOChannelBase(ctx) {\n    async onPush({ content /* options, message, messageSync, messageClass*/ }) {\n      // check if content.message\n      // not set content.message.to dynamic for test, which must be set by business\n      if (!content.message || !content.message.to) return false;\n      // scene\n      let scene;\n      let sceneTest = false;\n      // 1. maybe object by dynamic\n      if (content.scene && typeof content.scene === 'object') {\n        scene = content.scene;\n      } else {\n        // 2. from config cache\n        scene = ctx.bean.mailSceneCache.getMailSceneConfigCache(content.scene || 'system');\n      }\n      // 3. test\n      if (!this._sceneValid(scene) && (ctx.app.meta.isTest || ctx.app.meta.isLocal)) {\n        scene = await this._createSceneTest();\n        sceneTest = true;\n      }\n      // check if empty\n      if (!this._sceneValid(scene)) {\n        const message = chalk.keyword('orange')(ctx.text('mailhostNotConfigAlert'));\n        console.log('\\n' + boxen(message, boxenOptions));\n        return false;\n      }\n      // transporter\n      const transporter = nodemailer.createTransport(scene.transport, scene.defaults);\n      // send\n      const res = await transporter.sendMail(content.message);\n      // log\n      if (sceneTest) {\n        const url = nodemailer.getTestMessageUrl(res);\n        const message =\n          chalk.keyword('cyan')('Test Mail To: ') +\n          chalk.keyword('yellow')(content.message.to) +\n          chalk.keyword('orange')('\\n' + url);\n        console.log('\\n' + boxen(message, boxenOptions));\n      }\n      // done\n      return true;\n    }\n\n    async _createSceneTest() {\n      const account = await nodemailer.createTestAccount();\n      return {\n        transport: {\n          host: account.smtp.host,\n          port: account.smtp.port,\n          secure: account.smtp.secure,\n          auth: {\n            user: account.user,\n            pass: account.pass,\n          },\n          logger: false,\n          debug: false,\n        },\n        defaults: {\n          // sender info\n          from: 'Nodemailer <example@nodemailer.com>',\n        },\n      };\n    }\n\n    _sceneValid(scene) {\n      return scene && scene.transport && scene.transport.host;\n    }\n  }\n  return IOChannel;\n};\n","module.exports = ctx => {\n  const moduleInfo = ctx.app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class IOMessage extends ctx.app.meta.IOMessageBase(ctx) {\n    async onChannelRender({ channelFullName, options, message, messageSync, messageClass }) {\n      if (channelFullName === 'a-mail:mail') {\n        return await this._onChannelRenderMail({ options, message, messageSync, messageClass });\n      }\n      // super\n      return await super.onChannelRender({ channelFullName, options, message, messageSync, messageClass });\n    }\n\n    async _onChannelRenderMail({ message }) {\n      const content = JSON.parse(message.content);\n      const modelMail = ctx.model.module(moduleInfo.relativeName).mail;\n      const mail = await modelMail.get({ id: content.mailId });\n      return {\n        scene: mail.scene,\n        message: JSON.parse(mail.message),\n      };\n    }\n  }\n  return IOMessage;\n};\n","module.exports = app => {\n  class Startup extends app.meta.BeanBase {\n    async execute(/* context*/) {\n      // cache all mailScenes\n      await this.ctx.bean.mailSceneCache._cacheMailScenesConfig();\n    }\n  }\n\n  return Startup;\n};\n","module.exports = app => {\n  class Version extends app.meta.BeanBase {\n    async update(options) {\n      if (options.version === 1) {\n        // create table: aMail\n        const sql = `\n          CREATE TABLE aMail (\n            id int(11) NOT NULL AUTO_INCREMENT,\n            createdAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n            updatedAt timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n            deleted int(11) DEFAULT '0',\n            iid int(11) DEFAULT '0',\n            scene varchar(50) DEFAULT NULL,\n            status int(11) DEFAULT '0',\n            mailTo text DEFAULT NULL,\n            mailSubject text DEFAULT NULL,\n            message LONGTEXT DEFAULT NULL,\n            PRIMARY KEY (id)\n          )\n        `;\n        await this.ctx.model.query(sql);\n      }\n    }\n\n    async init(options) {\n      if (options.version === 1) {\n        // empty\n      }\n    }\n\n    async test() {}\n  }\n\n  return Version;\n};\n","const versionManager = require('./bean/version.manager.js');\nconst ioMessageMail = require('./bean/io.message.mail.js');\nconst ioChannelMail = require('./bean/io.channel.mail.js');\nconst broadcastMailSceneChanged = require('./bean/broadcast.mailSceneChanged.js');\nconst startupCacheMailScenes = require('./bean/startup.cacheMailScenes.js');\nconst beanMail = require('./bean/bean.mail.js');\nconst beanMailSceneCache = require('./bean/bean.mailSceneCache.js');\n\nmodule.exports = app => {\n  const beans = {\n    // version\n    'version.manager': {\n      mode: 'app',\n      bean: versionManager,\n    },\n    // io\n    'io.message.mail': {\n      mode: 'ctx',\n      bean: ioMessageMail,\n    },\n    'io.channel.mail': {\n      mode: 'ctx',\n      bean: ioChannelMail,\n    },\n    // broadcast\n    'broadcast.mailSceneChanged': {\n      mode: 'app',\n      bean: broadcastMailSceneChanged,\n    },\n    // startup\n    'startup.cacheMailScenes': {\n      mode: 'app',\n      bean: startupCacheMailScenes,\n    },\n    // global\n    mail: {\n      mode: 'ctx',\n      bean: beanMail,\n      global: true,\n    },\n    mailSceneCache: {\n      mode: 'ctx',\n      bean: beanMailSceneCache,\n      global: true,\n    },\n  };\n  return beans;\n};\n","// eslint-disable-next-line\nmodule.exports = appInfo => {\n  const config = {};\n\n  // startups\n  config.startups = {\n    cacheMailScenes: {\n      bean: 'cacheMailScenes',\n      instance: true,\n    },\n  };\n\n  // broadcasts\n  config.broadcasts = {\n    mailSceneChanged: {\n      bean: 'mailSceneChanged',\n    },\n  };\n\n  // default\n  config.scene = {\n    default: {\n      // title: undefined,\n      transport: {\n        host: '',\n        port: 0,\n        secure: false,\n        auth: {\n          user: '',\n          pass: '',\n        },\n        logger: false,\n        debug: false,\n      },\n      defaults: {\n        from: '',\n      },\n    },\n  };\n  // scenes\n  config.scenes = {\n    system: {\n      title: 'System',\n      ...config.scene.default,\n    },\n  };\n\n  return config;\n};\n","// error code should start from 1001\nmodule.exports = {};\n","module.exports = {\n  mailhostNotConfigAlert: 'Please set module config: [a-mail].scenes.system',\n};\n","module.exports = {\n  'Mail Management': '邮件管理',\n  mailhostNotConfigAlert: '请设置模块配置: [a-mail].scenes.system',\n};\n","module.exports = {\n  'en-us': require('./locale/en-us.js'),\n  'zh-cn': require('./locale/zh-cn.js'),\n};\n","module.exports = app => {\n  const ChannelMail = {\n    info: {\n      bean: 'mail',\n      title: 'Mail',\n    },\n  };\n  return ChannelMail;\n};\n","module.exports = app => {\n  const MessageMail = {\n    info: {\n      bean: 'mail',\n      title: 'Mail',\n      persistence: false,\n      push: {\n        channels: ['a-mail:mail'],\n      },\n    },\n  };\n  return MessageMail;\n};\n","module.exports = app => {\n  // const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  const resources = [\n    // menu\n    {\n      atomName: 'Mail Management',\n      atomStaticKey: 'mailManagement',\n      atomRevision: 2,\n      atomCategoryId: 'a-base:menu.BasicAdmin',\n      resourceType: 'a-base:menu',\n      resourceConfig: JSON.stringify({\n        actionPath: '/a/mail/scene/list',\n      }),\n      resourceIcon: ':outline:mail-outline',\n      appKey: 'a-appbooster:appSystem',\n      resourceRoles: 'template.system',\n      resourceSorting: 6,\n    },\n  ];\n  return resources;\n};\n","module.exports = app => {\n  const schemas = {};\n  schemas.mailScene = {\n    type: 'object',\n    properties: {\n      transport: {\n        type: 'object',\n        ebType: 'group',\n        ebTitle: 'MailTransportInfo',\n        properties: {\n          title: {\n            type: 'string',\n            ebType: 'text',\n            ebTitle: 'Title',\n            notEmpty: true,\n          },\n          host: {\n            type: 'string',\n            ebType: 'text',\n            ebTitle: 'MailHost',\n            notEmpty: true,\n          },\n          port: {\n            type: 'number',\n            ebType: 'text',\n            ebTitle: 'MailPort',\n            notEmpty: true,\n          },\n          secure: {\n            type: 'boolean',\n            ebType: 'toggle',\n            ebTitle: 'MailSecure',\n          },\n        },\n      },\n      auth: {\n        type: 'object',\n        ebType: 'group',\n        ebTitle: 'Auth Info',\n        properties: {\n          user: {\n            type: 'string',\n            ebType: 'text',\n            ebTitle: 'MailAuthUser',\n            notEmpty: true,\n          },\n          pass: {\n            type: 'string',\n            ebType: 'text',\n            ebTitle: 'MailAuthPassword',\n            notEmpty: true,\n          },\n        },\n      },\n      __groupDefaultsInfo: {\n        ebType: 'group-flatten',\n        ebTitle: 'Defaults Info',\n      },\n      defaults: {\n        type: 'object',\n        ebType: 'json',\n        ebTitle: 'Defaults',\n      },\n      extra: {\n        type: 'object',\n        ebType: 'group',\n        ebTitle: 'Extra Info',\n        properties: {\n          logger: {\n            type: 'boolean',\n            ebType: 'toggle',\n            ebTitle: 'logger',\n          },\n          debug: {\n            type: 'boolean',\n            ebType: 'toggle',\n            ebTitle: 'debug',\n          },\n        },\n      },\n    },\n  };\n  return schemas;\n};\n","const mailScene = require('./schema/mailScene.js');\n\nmodule.exports = app => {\n  const schemas = {};\n  Object.assign(schemas, mailScene(app));\n  return schemas;\n};\n","module.exports = app => {\n  class SceneController extends app.Controller {\n    async list() {\n      // check demo\n      this.ctx.bean.util.checkDemo();\n      const res = await this.ctx.service.scene.list();\n      this.ctx.success(res);\n    }\n\n    async save() {\n      // check demo\n      this.ctx.bean.util.checkDemo();\n      // adjust\n      const sceneName = this.ctx.request.body.sceneName;\n      const data = this.ctx.request.body.data;\n      const data2 = {\n        title: data.transport.title,\n        transport: {\n          ...data.transport,\n          auth: data.auth,\n          logger: data.extra.logger,\n          debug: data.extra.debug,\n        },\n        defaults: data.defaults,\n      };\n      delete data2.transport.title;\n      // save\n      await this.service.scene.save({\n        sceneName,\n        data: data2,\n      });\n      // ok\n      const list = await this.ctx.service.scene.list();\n      const res = list[sceneName];\n      this.ctx.success(res);\n    }\n\n    async delete() {\n      // check demo\n      this.ctx.bean.util.checkDemo();\n      await this.service.scene.delete({\n        sceneName: this.ctx.request.body.sceneName,\n      });\n      const list = await this.ctx.service.scene.list();\n      this.ctx.success({ list });\n    }\n\n    async add() {\n      // check demo\n      this.ctx.bean.util.checkDemo();\n      await this.service.scene.add({\n        sceneName: this.ctx.request.body.sceneName,\n        data: this.ctx.request.body.data,\n      });\n      const list = await this.ctx.service.scene.list();\n      this.ctx.success({ list });\n    }\n  }\n\n  return SceneController;\n};\n","const scene = require('./controller/scene.js');\n\nmodule.exports = app => {\n  const controllers = { scene };\n  return controllers;\n};\n","const config = require('./config/config.js');\nconst locales = require('./config/locales.js');\nconst errors = require('./config/errors.js');\n\nmodule.exports = app => {\n  // beans\n  const beans = require('./beans.js')(app);\n  // routes\n  const routes = require('./routes.js')(app);\n  // controllers\n  const controllers = require('./controllers.js')(app);\n  // services\n  const services = require('./services.js')(app);\n  // models\n  const models = require('./models.js')(app);\n  // meta\n  const meta = require('./meta.js')(app);\n\n  return {\n    beans,\n    routes,\n    controllers,\n    services,\n    models,\n    config,\n    locales,\n    errors,\n    meta,\n  };\n};\n","module.exports = app => {\n  // schemas\n  const schemas = require('./config/validation/schemas.js')(app);\n  // socketio\n  const socketioMessageMail = require('./config/socketio/messageMail.js')(app);\n  const socketioChannelMail = require('./config/socketio/channelMail.js')(app);\n  // static\n  const staticResources = require('./config/static/resources.js')(app);\n  // meta\n  const meta = {\n    base: {\n      atoms: {},\n      statics: {\n        'a-base.resource': {\n          items: staticResources,\n        },\n      },\n    },\n    validation: {\n      validators: {\n        mailScene: {\n          schemas: 'mailScene',\n        },\n      },\n      keywords: {},\n      schemas,\n    },\n    socketio: {\n      messages: {\n        mail: socketioMessageMail,\n      },\n      channels: {\n        mail: socketioChannelMail,\n      },\n    },\n  };\n  return meta;\n};\n","module.exports = app => {\n  class Mail extends app.meta.Model {\n    constructor(ctx) {\n      super(ctx, { table: 'aMail', options: { disableDeleted: false } });\n    }\n  }\n  return Mail;\n};\n","const mail = require('./model/mail.js');\n\nmodule.exports = app => {\n  const models = {\n    mail,\n  };\n  return models;\n};\n","module.exports = app => {\n  const routes = [\n    // scene\n    {\n      method: 'post',\n      path: 'scene/list',\n      controller: 'scene',\n      meta: { right: { type: 'resource', name: 'mailManagement' } },\n    },\n    {\n      method: 'post',\n      path: 'scene/save',\n      controller: 'scene',\n      middlewares: 'validate',\n      meta: {\n        right: { type: 'resource', name: 'mailManagement' }, //\n        validate: { validator: 'mailScene' },\n      },\n    },\n    {\n      method: 'post',\n      path: 'scene/delete',\n      controller: 'scene',\n      meta: { right: { type: 'resource', name: 'mailManagement' } },\n    },\n    {\n      method: 'post',\n      path: 'scene/add',\n      controller: 'scene',\n      meta: { right: { type: 'resource', name: 'mailManagement' } },\n    },\n  ];\n  return routes;\n};\n","module.exports = app => {\n  const moduleInfo = app.meta.mockUtil.parseInfoFromPackage(__dirname);\n  class Scene extends app.Service {\n    get statusModule() {\n      return this.ctx.bean.status.module(moduleInfo.relativeName);\n    }\n\n    async list() {\n      return this.ctx.bean.mailSceneCache.getMailScenesConfigForAdmin();\n    }\n\n    async save({ sceneName, data }) {\n      const scenes = this.ctx.bean.mailSceneCache.getMailScenesConfigCache();\n      const sceneOld = scenes[sceneName];\n      data = this.ctx.bean.util.extend({}, sceneOld, data);\n      await this._save({ sceneName, data });\n    }\n\n    async _save({ sceneName, data }) {\n      const scenes = this.ctx.bean.mailSceneCache.getMailScenesConfigCache();\n      scenes[sceneName] = data ? this.ctx.bean.mailSceneCache.purgeScene(data) : data;\n      // update\n      await this.statusModule.set('mailScenes', scenes);\n      // changed\n      await this.ctx.bean.mailSceneCache.mailSceneChanged();\n    }\n\n    async delete({ sceneName }) {\n      await this._save({ sceneName, data: undefined });\n    }\n\n    async add({ sceneName, data }) {\n      data = this.ctx.bean.util.extend({}, this.ctx.config.scene.default, data);\n      await this._save({ sceneName, data });\n    }\n  }\n\n  return Scene;\n};\n","const scene = require('./service/scene.js');\n\nmodule.exports = app => {\n  const services = { scene };\n  return services;\n};\n","module.exports = require(\"require3\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(421);\n",""],"names":[],"sourceRoot":""}